services:
    pharmacy_catalog_node1:
      container_name: pharmacy_catalog_node1
      build:
        dockerfile: Dockerfile
      command:
        - "make"
        - "run"
      restart: always
      env_file:
        - .env
      networks:
        - pharmacy_catalog

    pharmacy_catalog_node2:
      container_name: pharmacy_catalog_node2
      build:
        dockerfile: Dockerfile
      command:
        - "make"
        - "run"
      restart: always
      env_file:
        - .env
      networks:
        - pharmacy_catalog

    pharmacy_catalog_db:
      image: postgres:16.2
      container_name: pharmacy_catalog_db
      restart: always
      shm_size: 128mb
      environment:
        POSTGRES_PASSWORD: 1234
        POSTGRES_USER: symon
        POSTGRES_DB: pharmacy_catalog
      volumes:
        - pharmacy_catalog_db:/var/lib/postgresql/data
      networks:
        - pharmacy_catalog

    nginx_catalog:
      image: nginx:latest
      volumes:
        - /opt/homebrew/etc/nginx/catalog_nginx.conf:/etc/nginx/nginx.conf
      depends_on:
        - pharmacy_catalog_node1
        - pharmacy_catalog_node2
      networks:
        - pharmacy_catalog
        - pharmacy_gateway

volumes:
  pharmacy_catalog_db:
    driver: local

networks:
  pharmacy_catalog:
    driver: bridge
  pharmacy_gateway:
    external: true
